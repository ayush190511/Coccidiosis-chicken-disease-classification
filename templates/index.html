<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Object Classification</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

<style>
body{background:#eff2f9}

.image-part{
    height:300px;width:300px;
    border:2px dashed #1b2d6b;
    margin:auto;
}
.image-part img{height:300px;width:300px;padding:5px}

.result-card{
    min-height:300px;
    border-radius:10px;
}

.prediction-label{
    font-size:26px;
    font-weight:700;
    color:#28a745;
    margin-top:30px;
}

.prediction-badge{
    font-size:16px;
    padding:8px 14px;
}

#loading{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(255,255,255,.7);z-index:9999;
}
.loader{
    border:8px solid #eee;border-top:8px solid #007bff;
    border-radius:50%;width:60px;height:60px;
    position:absolute;top:50%;left:50%;
    transform:translate(-50%,-50%);
    animation:spin 1s linear infinite;
}
@keyframes spin{100%{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="container mt-4">
<h3 class="text-center mb-4">Object Classification</h3>

<div class="row">

<!-- LEFT -->
<div class="col-md-6 text-center">
    <div class="image-part">
        <img id="photo" style="display:none"/>
    </div>

    <div class="mt-3">
        <button class="btn btn-primary" id="uload">Upload</button>
        <button class="btn btn-success" id="send" disabled>Predict</button>
        <button class="btn btn-danger" id="reset">Reset</button>
    </div>

    <input type="file" id="fileinput" hidden>
    <input type="hidden" id="url" value="../predict">
</div>

<!-- RIGHT -->
<div class="col-md-6">
<div class="card result-card shadow">
    <div class="card-header bg-primary text-white text-center">
        Prediction Results
    </div>

    <div class="card-body text-center">
        <div class="res-part text-muted">
            Upload image and click <b>Predict</b>
        </div>
    </div>

    <div class="card-footer text-center text-muted">
        Model inference output
    </div>
</div>
</div>

</div>
</div>

<div id="loading" style="display:none">
    <div class="loader"></div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
let base_data="";

$("#uload").click(()=>$("#fileinput").click());

$("#reset").click(()=>{
    base_data="";
    $("#photo").hide();
    $(".res-part").html("Upload image and click <b>Predict</b>");
    $("#send").prop("disabled",true);
});

$("#fileinput").change(function(){
    const reader=new FileReader();
    reader.onload=e=>{
        $("#photo").attr("src",e.target.result).show();
        base_data=e.target.result.split(",")[1];
        $("#send").prop("disabled",false);
    };
    reader.readAsDataURL(this.files[0]);
});

$("#send").click(()=>{
    $("#loading").show();

    $.ajax({
        url:$("#url").val(),
        type:"POST",
        contentType:"application/json",
        data:JSON.stringify({image:base_data}),
        success:function(res){
            $("#loading").hide();
            console.log("SERVER RESPONSE:", res);

            // âœ… YOUR EXACT RESPONSE FORMAT
            const predictionText = res[0].image;

            const html = `
                <span class="badge badge-success prediction-badge">
                    Detected
                </span>
                <div class="prediction-label">
                    ${predictionText}
                </div>
            `;

            $(".res-part").html(html);
        },
        error:function(){
            $("#loading").hide();
            $(".res-part").html(
                "<span class='text-danger'>Server error</span>"
            );
        }
    });
});
</script>
</body>
</html>
